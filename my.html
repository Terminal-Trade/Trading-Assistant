<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>üì¶ TerminalPro ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è/—Ö–æ—Å—Ç–∏–Ω–≥-–∑–∞–≥—Ä—É–∑–∫–∞</title>
<style>
body{font-family:"Segoe UI",Arial,sans-serif;background:#1e1e1e;color:#eee;margin:0;padding:40px;}
#box{max-width:720px;margin:auto;background:#2b2b2b;border-radius:12px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.25);}
h1{margin:0 0 8px 0;text-align:center}
p{margin:6px 0 16px 0;color:#bbb}
button{width:100%;margin-top:10px;padding:12px 14px;border:0;border-radius:8px;background:#0078d7;color:#fff;font-size:15px;cursor:pointer}
button:hover{background:#0062ad}
#progress{margin-top:14px;height:18px;background:#333;border-radius:999px;overflow:hidden;display:none}
#bar{height:100%;width:0;background:linear-gradient(90deg,#0078d7,#00d4ff)}
#log{margin-top:14px;font-family:ui-monospace,Consolas,monospace;background:#111;color:#0f0;padding:10px;border-radius:8px;height:240px;overflow:auto;white-space:pre-line}
.warn{color:#ffcc66}.err{color:#ff6b6b}.ok{color:#7CFC00}
#choose{background:#444}
</style>
</head>
<body>
<div id="box">
  <h1>üì¶ TerminalPro Downloader</h1>
  <p>–§–∞–π–ª <b>TerminalPro.zip</b> –¥–æ–ª–∂–µ–Ω –ª–µ–∂–∞—Ç—å –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ, —á—Ç–æ –∏ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞.</p>

  <button id="choose">üìÇ –í—ã–±—Ä–∞—Ç—å –ø–∞–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (Chromium)</button>
  <button id="download">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å TerminalPro.zip</button>

  <div id="progress"><div id="bar"></div></div>
  <div id="log"></div>
</div>

<script>
let dirHandle=null;
// –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Ä—è–¥–æ–º —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π
const zipUrl = new URL('./TerminalPro.zip', location.href).href;

const el = id => document.getElementById(id);
const log = (msg, cls='') => {
  const box = el('log');
  box.innerHTML += (cls?`<span class="${cls}">`:'') + msg + (cls?'</span>':'') + '\n';
  box.scrollTop = box.scrollHeight;
};

el('choose').onclick = async () => {
  if (!('showDirectoryPicker' in window)) {
    log('‚ö†Ô∏è –í—ã–±–æ—Ä –ø–∞–ø–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ Chrome/Edge.', 'warn');
    return;
  }
  try {
    dirHandle = await window.showDirectoryPicker();
    log('üìÇ –ü–∞–ø–∫–∞ –≤—ã–±—Ä–∞–Ω–∞: ' + dirHandle.name);
  } catch(e) {
    if (e.name!=='AbortError') log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–±—Ä–∞—Ç—å –ø–∞–ø–∫—É: ' + e.message, 'err');
  }
};

el('download').onclick = async () => {
  // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ (file://) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É (–±–µ–∑ fetch, CORS –Ω–µ –º–µ—à–∞–µ—Ç)
  if (location.protocol === 'file:') {
    const a = document.createElement('a');
    a.href = zipUrl;          // file:///‚Ä¶/TerminalPro.zip
    a.download = 'TerminalPro.zip';
    document.body.appendChild(a); a.click(); a.remove();
    log('‚úÖ –û—Ç–∫—Ä—ã—Ç–∞ —Å–∏—Å—Ç–µ–º–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (–ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º).', 'ok');
    return;
  }
  // –ï—Å–ª–∏ –ø–æ http(s) ‚Äî –ø—Ä–æ–±—É–µ–º fetch —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
  await downloadWithFetch(zipUrl, 'TerminalPro.zip');
};

async function downloadWithFetch(url, name) {
  el('progress').style.display='block'; el('bar').style.width='0%';
  log('üîó –ó–∞–≥—Ä—É–∑–∫–∞: ' + name);
  try {
    const resp = await fetch(url, { cache: 'no-store' });
    if (!resp.ok) throw new Error('HTTP '+resp.status);
    const total = +resp.headers.get('Content-Length') || 0;
    const reader = resp.body?.getReader ? resp.body.getReader() : null;
    const chunks = []; let received = 0;

    if (reader) {
      while (true) {
        const {done, value} = await reader.read();
        if (done) break;
        chunks.push(value); received += value.length;
        if (total) el('bar').style.width = ((received/total)*100).toFixed(1)+'%';
      }
    } else {
      chunks.push(new Uint8Array(await resp.arrayBuffer()));
      received = chunks[0].length;
    }

    const blob = new Blob(chunks);
    let path = "—á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫‚Ä¶¬ª";
    if (dirHandle && dirHandle.createWritable) {
      const fh = await dirHandle.getFileHandle(name, { create:true });
      const w = await fh.createWritable(); await w.write(blob); await w.close();
      path = `${dirHandle.name}/${name}`;
    } else {
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = name;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(a.href);
    }
    el('bar').style.width='100%';
    log('‚úÖ –°–æ—Ö—Ä–∞–Ω—ë–Ω ‚Üí üìÅ ' + path, 'ok');
  } catch (e) {
    log('‚ùå –û—à–∏–±–∫–∞: ' + e.message, 'err');
    if (location.hostname.endsWith('.github.io')) {
      log('‚ÑπÔ∏è –ü—Ä–æ–≤–µ—Ä—å: —Ñ–∞–π–ª –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ '+url+' ? (—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –†–ï–ì–ò–°–¢–†–£ –∏ –ø—É—Ç–∏)', 'warn');
    }
  } finally {
    el('progress').style.display='none';
  }
}
</script>
</body>
</html>
